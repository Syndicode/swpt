const v="school/v1",h="user",L=`/wp-json/${v}/${h}`,w="login",i=[],o=(e,r)=>{i.unshift({type:r,text:e})},d=()=>{for(;i.length>0;)i.pop();const e=document.querySelector(".form__messages");e.innerHTML=""},n=()=>{const e=document.querySelector(".form__messages");e&&i.forEach(r=>{const s=document.createElement("p");s.classList.add("form__message",`form__message--${r.type}`),s.textContent=r.text,e.insertAdjacentElement("afterbegin",s)})},f=async(e,r)=>{const s=await fetch(`${L}/${r}/`,{method:"POST",body:e});if(s.ok)return await s.json()},u=e=>String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),p=e=>{let r=!0;return[...e.elements].forEach(s=>{(s.type==="text"||s.type==="email"||s.type==="password")&&s.required&&s.name!==w&&s.value===""&&(s.parentElement.classList.add("form__item--error"),r=!1)}),r},g=()=>{const e=document.querySelector("form#sign-up"),r=document.querySelector(".loader");if(e){[...e.elements].forEach(t=>{t.addEventListener("input",()=>{t.parentElement.classList.contains("form__item--error")&&t.parentElement.classList.remove("form__item--error")})});const s=e.querySelector("button.form__submit");s&&s.addEventListener("click",()=>{r.classList.add("loader--active"),d();let t=!0;p(e)||(o("Обовʼзкові поля не заповнені","error"),t=!1),u(e.elements.email.value)||(e.elements.email.parentElement.classList.add("form__item--error"),o("Введено некоректний Email","error"),t=!1),e.elements.password.value.length>=6||(e.elements.password.parentElement.classList.add("form__item--error"),e.elements.password_repeat.parentElement.classList.add("form__item--error"),o("Пароль має містити 6 і більше символів","error"),t=!1),e.elements.password.value===e.elements.password_repeat.value||(e.elements.password.parentElement.classList.add("form__item--error"),e.elements.password_repeat.parentElement.classList.add("form__item--error"),o("Паролі не співпадають","error"),t=!1),t?f(new FormData(e),"sign-up").then(l=>{l.success?setTimeout(()=>{const m=document.querySelector(".form"),c=document.querySelector("template#response").content.cloneNode(!0);c.querySelector("h2.heading span").textContent=e.elements.check_spam_field.value,m.innerHTML="",m.append(c),window.scrollTo({top:0,left:0,behavior:"smooth"}),r.classList.remove("loader--active")},1e3):(o(l.data.message,"error"),setTimeout(()=>{n(),window.scrollTo({top:0,left:0,behavior:"smooth"}),r.classList.remove("loader--active")},1e3),l.data.error_type==="email_registered"&&e.elements.email.parentElement.classList.add("form__item--error"))}):setTimeout(()=>{n(),window.scrollTo({top:0,left:0,behavior:"smooth"}),r.classList.remove("loader--active")},1e3)}),e.addEventListener("submit",t=>{t.preventDefault()})}},S=()=>{const e=document.querySelector("form#sign-in"),r=document.querySelector(".loader");if(e){const s=e.querySelector("button.form__submit");s&&([...e.elements].forEach(t=>{t.addEventListener("input",()=>{t.parentElement.classList.contains("form__item--error")&&t.parentElement.classList.remove("form__item--error")})}),s.addEventListener("click",()=>{r.classList.add("loader--active"),d();let t=!0;p(e)||(o("Обовʼзкові поля не заповнені","error"),t=!1),u(e.elements.email.value)||(e.elements.email.parentElement.classList.add("form__item--error"),o("Введено некоректний Email","error"),t=!1),t?f(new FormData(e),"sign-in").then(a=>{a.success?window.location.assign("/testing/"):(o(a.data.message,"error"),setTimeout(()=>{n(),window.scrollTo({top:0,left:0,behavior:"smooth"}),r.classList.remove("loader--active")},1e3),a.data.error_type==="email_registered"&&e.elements.email.parentElement.classList.add("form__item--error"))}):setTimeout(()=>{n(),window.scrollTo({top:0,left:0,behavior:"smooth"}),r.classList.remove("loader--active")},1e3)})),e.addEventListener("submit",t=>{t.preventDefault()})}},q=()=>{g(),S()};export{q as authentication};
